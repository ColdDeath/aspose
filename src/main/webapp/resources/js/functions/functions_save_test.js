function createDataField(f,t){var p=".blockGroup",I=".blockElement",e=".upElem",m=".BlockDivCheckBox";t&&1===t&&(e=".upElemNew",p=".blockGroupNew",I=".blockElementNew",m=".BlockDivCheckBoxNew");f=parseInt(f);var b=[],T="",k=null,x="";return $(e).each(function(t){var e=t+1,i=$(this).attr("type"),a=$(this).val(),l=parseInt($(this).attr("data-field")),s=$(".chosen-select",this).attr("type"),d=parseInt($(".chosen-select",this).attr("data-field")),r=parseInt($(".chosen-select",this).val()),n=null,c=null,h=null;if("date"===i&&(x=1,""!=a&&(n=a+"T00:00:00",0)),"time"===i&&(x=1,""!=a&&(n="1900-01-01T"+a+":00")),"text"===i&&(x=2,""!=a&&(n=a)),"select"===s&&(x=3,0<r&&(n=r)),"checkbox"===i&&(x=4,0<a&&(n=a)),"tableHtml"===i&&(x=5,c=$("#catalogTables").attr("data-value"),$(".editTable .deleteElem").remove(),$(".editTable h6").remove(),h=$(".editTable").html()),0<f&&(k=parseInt($(this).attr("data-id"))),1===x)T={field:{id:k,childFields:[],fieldId:l,valueDate:n},position:e};else if(2===x)T={field:{id:k,childFields:[],fieldId:l,valueStr:n},position:e};else if(3===x)0<f&&(k=parseInt($(".chosen-select",this).attr("data-id"))),T={field:{id:k,childFields:[],fieldId:d,valueInt:n},position:e};else if(4===x){0<f&&(k=parseInt($(this).attr("data-id")));var o=[],u="",v=$(this).attr("id");$("#"+v+"BlockDiv .checkClass").each(function(){var t=null;0<f&&(t=parseInt($(this).attr("data-id")));var e=$(this).val(),i=parseInt($(this).attr("data-field")),a=$(this).attr("type");u="select"===a?{id:t,childFields:[],fieldId:i,valueInt:e}:{id:t,childFields:[],fieldId:i,valueStr:e},o.push(u)}),$(m).each(function(){$(p,this).each(function(){var t=parseInt($(this).attr("data-div"));0<f&&(k=parseInt($(this).attr("data-id")));var s=[];$(I,this).each(function(){var t=$(this).attr("type");if(0<f&&(k=parseInt($(this).attr("data-id"))),t&&""!=t){if("tableHtml"===t){var e=$(this).attr("data-value"),i="#"+$(this).attr("id");$(i+" .editTable .deleteElem, "+i+" .editTable h6").remove();var a=$(i+" .editTable").html(),l={id:k,childFields:[],fieldId:parseInt($(this).attr("data-field")),valueInt:e,valueStr:a}}else if("select"===t)l={id:k,childFields:[],fieldId:parseInt($(this).attr("data-field")),valueInt:parseInt($(this).val())};else if("text"===t)l={id:k,childFields:[],fieldId:parseInt($(this).attr("data-field")),valueStr:$(this).val()}}else l={id:k,childFields:[],fieldId:parseInt($(this).attr("data-field")),valueStr:$(this).val()};s.push(l)});var e={id:k,childFields:s,fieldId:t};o.push(e)})}),T={field:{id:k,childFields:o,fieldId:l,valueInt:n},position:e}}else 5===x&&(T={field:{id:k,childFields:[],fieldId:l,valueInt:c,valueStr:h},position:e});b.push(T)}),b}function createDataBlock(o,a,t){var e=".blockGroup",i=".BlockDiv",l=".blockElement";t&&1===t&&(e=".blockGroupNew",i=".BlockDivNew",l=".blockElementNew");o=parseInt(o);var u=null,s=[];return $(i).each(function(){$(e,this).each(function(){var t=parseInt($(this).attr("data-div"));0<o&&(u=parseInt($(this).attr("data-id")));var h=[];$(l,this).each(function(){var t=$(this).attr("type");if(0<o&&(u=parseInt($(this).attr("data-id"))),t&&""!=t){if("tableHtml"===t){var e=$(this).attr("data-value"),i="#"+$(this).attr("id");$(i+" .editTable .deleteElem, "+i+" .editTable h6").remove();var a=$(i+" .editTable").html(),l={id:u,childFields:[],fieldId:parseInt($(this).attr("data-field")),valueInt:e,valueStr:a}}else if("select"===t)l={id:u,childFields:[],fieldId:parseInt($(this).attr("data-field")),valueInt:parseInt($(this).val())};else if("text"===t)l={id:u,childFields:[],fieldId:parseInt($(this).attr("data-field")),valueStr:$(this).val()};else if("checkbox"===t){var s=$(this).val(),d=parseInt($(this).attr("data-field"));0<o&&(u=parseInt($(this).attr("data-id")));var r=$(this).attr("id"),n=[],c="";$("#"+r+"BlockDiv .checkClass").each(function(){var t=null;0<o&&(t=parseInt($(this).attr("data-id")));var e=$(this).val(),i=parseInt($(this).attr("data-field")),a=$(this).attr("type");c="select"===a?{id:t,childFields:[],fieldId:i,valueInt:e}:{id:t,childFields:[],fieldId:i,valueStr:e},n.push(c)}),l={id:u,childFields:n,fieldId:d,valueInt:s}}}else l={id:u,childFields:[],fieldId:parseInt($(this).attr("data-field")),valueStr:$(this).val()};h.push(l)});var e=parseInt(a)+parseInt(countElem(s)),i={field:{id:u,childFields:h,fieldId:t},position:e};s.push(i)})}),s}function createAgreeList(t){var e=[],i=$(t).length,a=!1,l=!1;for(var s in t)if(s<i){var d=parseInt(s)+1;a=d===i,l=1===d;var r={id:null,ordering:d,user:{id:t[s].value},finalUser:a,currentUser:l};e.push(r)}return e}function createJSON(t,e,i,a,l){0===(t=parseInt(t))&&(t=null);var s=[],d=[],r="#whomList",n="#userListBlock";l&&1===l&&(r="#whomListNew",n="#userListBlockNew");for(var c=$(n+" select:last").val(),h=(r=ChosenOrder.getSelectionOrder($(r).get(0)),0);h<r.length;h++){var o=r[h];""!==o&&d.push(o)}if(l&&2===l&&(c=$("#userListBlockDiv .row:last").attr("data-value"),$("#whomList div").each(function(){var t=$(this).attr("data-value");""!==t&&d.push(t)})),""!==i)for(var u in i)s.push(i[u]);if(""!==a)for(var u in a)s.push(a[u]);if(l&&2===l)var v=$("#commentText textarea").val(),f={id:t,docTypeId:parseInt(e),executorDepartmentsIds:d,finalUserId:c,comment:v,childFields:s};else if(l&&1===l)f={id:null,docTypeId:parseInt(e),executorDepartmentsIds:d,finalUserId:c,parentDocId:t,childFields:s};else f={id:t,docTypeId:parseInt(e),executorDepartmentsIds:d,finalUserId:c,childFields:s};return f}function getDepartments(t){$.ajax({url:t,dataType:"json",async:!1,success:function(t){$("#whomList").append('<div class="d-inline-block chip light-blue lighten-2 white-text my-1 mr-2" data-value="'+t.id+'">'+t.name+"</div>")}})}function createWhomListDisabled(t){for(var e in t){getDepartments("rest/profile/departments/"+t[e])}}function createUserListDisabled(t,n){return $.getJSON(t,function(t){for(var e in t){var i=t[e],a="",l="",s="",d="";if(i.agreedDateTime)s=formatDate(i.agreedDateTime)+"/"+formatTime(i.agreedDateTime);i.comment&&(l=i.comment),i.position&&(a=i.position);var r="";!0===i.currentUser?(r='<i class="fas fa-user-clock text-warning" title="Текущий согласователь"></i>',1!==n&&(d='<button class="btn btn-primary btn-sm px-2 py-1 mx-3 btnReturn" type="button" data-undo="'+i.userId+'" title="Перенаправить на согласование"><i class="fas fa-undo-alt text-white"></i></button>')):r='<i class="fas fa-ellipsis-h text-muted" title="Согласователь"></i>',i.decisionType&&"ACCEPTED"===i.decisionType&&(r='<i class="fas fa-check text-success" title="Согласование завершено"></i>',!0===i.finalUser&&(r='<i class="fas fa-check-circle text-success" title="Финальный согласователь"></i>')),i.decisionType&&"REDIRECTED"===i.decisionType&&(r='<i class="fas fa-undo-alt text-primary" title="Перенаправление"></i>'),i.decisionType&&"REJECTED"===i.decisionType&&(r='<i class="fas fa-times text-danger" title="Согалсование отменено"></i>'),$("#userListBlockDiv").append('<div class="row mb-3 d-flex align-items-center" data-value="'+i.userId+'"><div class="col-1 text-center">'+i.ordering+'</div><div class="col-1 text-center">'+r+'</div><div class="col-4">'+i.fullName+d+'<br><small class="text-muted">'+a+'</small></div><div class="col-3"><small>'+l+'</small></div><div class="col-3"><small>'+s+"</small></div></div>")}})}