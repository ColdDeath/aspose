function getUpFields(e,D,E,G){var C="#blockUp",S="upElem",_="inputDate",A="inputTime",O="blockDate",R="blockTime",L=1;return G&&1===G&&(C="#blockUpNew",S="upElemNew",_="inputDateNew",A="inputTimeNew",O="blockDateNew",R="blockTimeNew",L=2),$.getJSON(e,function(e){var t=e;for(var l in 0<D&&1!==G&&(t=e.childFields),t){var a=t[l],d="",i="",s="",c="";0<D&&(c=a.field.valueInt),0==a.field.enabled&&(s=" disabled");var n="",r="",o="";1==a.field.required&&(n=" required",r='<sup><i class="fas fa-star-of-life ml-1 text-danger"></i></sup>',o='<div class="invalid-feedback">Поле обязательно для заполнения</div>');var f="selectField"+a.field.fieldId;if("DATE"===a.field.fieldType&&(0<D&&(i=a.field.id,""!==a.field.valueDate&&(d=formatDate(a.field.valueDate,1))),createInput(C,"date",O,_,"Введите дату",E,'<i class="fas fa-calendar-alt mr-2"></i>'+a.field.name,d,a.field.fieldId,L,i,a.field.enabled,a.field.required,"","")),"TIME"===a.field.fieldType&&(0<D&&(i=a.field.id,""!==a.field.valueDate&&(d=formatTime(a.field.valueDate))),createInput(C,"time",R,A,"Введите время",E,'<i class="fas fa-clock mr-2"></i>'+a.field.name,d,a.field.fieldId,L,i,a.field.enabled,a.field.required,"","")),"GROUP_CHECKBOX"===a.field.fieldType){var v='value="0"',p="";if(i=a.field.fieldId,0<a.field.valueInt&&(v='value="'+a.field.valueInt+'"',p=" checked"),$(C).append('<div class="row my-3"><div class="col-md-12 text-left"><div class="form-check"><input type="checkbox" class="form-check-input '+S+'" id="'+a.field.tag+'" data-field="'+i+'" name="'+a.field.tag+'" '+v+p+'><label class="form-check-label text-muted text-left" for="'+a.field.tag+'">'+a.field.name+"</label></div></div></div>"),0<a.field.childFields.length)for(var m in $(C).append('<div id="'+a.field.tag+'BlockDiv" class="childBox d-none"></div>'),a.field.childFields){var u=a.field.childFields[m];i=null,0<D&&(i=u.id);var b=C+" #"+a.field.tag+"BlockDiv",h=m+1;if("TEXT"===u.fieldType){var I="checkText_"+h;createInput(b,"text",I,I,"Введите значение",E,u.name,u.valueStr,u.fieldId,"",i,u.enabled,u.required,"","","checkClass")}if("TEXTAREA"===u.fieldType){var w="textarea_"+h,x="",g="";0<u.id&&(x=' data-id="'+u.id+'"',g=u.valueStr),$(b).append('<div class="row ml-1 mb-3"><div class="col-md-3 text-left mt-3"><div class="text-muted">'+u.name+r+'</div></div><div class="col-md-9 mt-3"><textarea type="text" id="'+w+'" class="checkClass form-control" data-field="'+u.fieldId+'"'+x+">"+g+"</textarea>"+o+"</div></div>")}h+=1}checkedFields("#"+a.field.tag,"#"+a.field.tag+"BlockDiv"),0<a.field.valueInt&&$(".childBox").removeClass("d-none")}h=l+1;if("TEXT"===a.field.fieldType){var T="_";0<D&&(i=a.field.id,T=a.field.id+"_");I="inputText_"+T+h;createInput(C,"text",I,I,"Введите значение",E,a.field.name,a.field.valueStr,a.field.fieldId,L,i,a.field.enabled,a.field.required,"",""),h+=1}var k="",y="";if(0<a.field.parentCatalogId&&(y=" p"+a.field.parentCatalogId,k=" d-none"),0<D&&0<a.field.parentCatalogId&&(y=" p"+a.field.parentCatalogId,k=a.field.valueInt&&0<a.field.valueInt?"":" d-none"),"CATALOG"===a.field.fieldType){0<D&&(i=' data-id="'+a.field.id+'"');var F="#"+f;$(C).append('<div class="row blockRowUp '+S+k+y+' ml-1 mb-3"><div class="col-md-3 text-left mt-3"><div class="text-muted">'+a.field.name+r+'</div></div><div class="col-md-9"><select data-placeholder="Выберите вид документа" class="chosen-select" searchable=" Поиск" type="select" id="'+f+'" name="'+f+'" data-catalog="'+a.field.catalogId+'" data-field="'+a.field.fieldId+'"'+i+s+n+'><option value="">Выберите значение справочника</option></select>'+o+"</div></div>"),$(F).chosen({width:"100%",no_results_text:"Ничего не найдено!"}),createOptionsValue(F,C,".blockRowUp"),""==k&&createOptions("rest/profile/catalogs/"+a.field.catalogId+"/elems",F,"valueStr","id",c,"")}if("CATALOG_ORGANIZATIONS"===a.field.fieldType){F="#"+f;$(C).append('<div class="row blockRowUp '+S+k+y+' ml-1 mb-3 d-flex align-items-center"><div class="col-md-3 text-left mt-3"><div class="text-muted">'+a.field.name+r+'</div></div><div class="col-md-8 mt-3"><select data-placeholder="Выберите вид документа" class="chosen-select" type="select" id="'+f+'" name="'+f+'" data-catalog="'+a.field.catalogId+'" data-field="'+a.field.fieldId+'"'+i+s+n+'><option value="">Выберите значение справочника</option></select></div><div class="col-md-1 mt-3 text-right"><button class="btn btn-primary btn-sm addElement rounded m-0 px-3 waves-effect" data-toggle="modal" data-target="#addElement" data-catalog="'+F+'" type="button" title="Добавить организацию" '+s+'><i class="fas fa-plus white-text"></i></button></div><div class="col-md-3"></div><div class="col-9">'+o+"</div></div>"),$(F).chosen({width:"100%",no_results_text:"Ничего не найдено!"}),createOptions("rest/profile/organizations/",F,"shortNameLf","id",c,"")}if("CATALOG_REGNUMBERS"===a.field.fieldType){0<D&&(i=' data-id="'+a.field.id+'"'),$(C).append('<div class="row '+S+' ml-1 mb-3 d-flex align-items-center justify-content-center"><div class="col-md-3 text-left mt-3"><div class="text-muted">'+a.field.name+r+'</div></div><div class="col-md-9"><select data-placeholder="Выберите вид документа" class="chosen-select" searchable=" Поиск" type="select" id="'+f+'" name="'+f+'" data-field="'+a.field.fieldId+'"'+i+s+n+'><option value="">Выберите значение справочника</option></select>'+o+"</div></div>");F="#"+f;$(F).chosen({width:"100%",no_results_text:"Ничего не найдено!"}),createOptions("rest/profile/docs/regnumbers/",F,"regNum","id",c,"")}if("CATALOG_HTML_TABLES"===a.field.fieldType)if(0<D){$(C).append('<div class="row ml-1 mb-3 d-flex align-items-center justify-content-center" id="catalogTables" data-id="'+a.field.id+'" type="tableHtml" data-field="'+a.field.fieldId+'" data-value="'+a.field.valueInt+'">   <div class="col-md-12 text-left newTable">       <div class="btn btn-primary btn-sm rounded" id="tableTemplates" data-click="">Изменить макет таблицы</div>       <div class="editTable">           <h6 class="my-3 text-center"></h6>           '+a.field.valueStr+"       </div>   </div></div>");var N=parseInt($(".newTable table tbody tr:first td:last").html());N+=1,$(".newTable table thead tr:first").append('<th class="text-center deleteElem" rowspan="2">Удалить</th>'),$(".newTable table tbody tr:first").append('<td class="text-center deleteElem">'+N+"</td>"),$(".newTable table tbody tr:not(:first)").append('<td class="deleteElem">   <div class="btn btn-sm btn-danger table-remove rounded px-3 my-0">       <i class="fas fa-trash"></i>   </div></td>'),$(".newTable").append('<div class="row">   <div class="col-12 text-right">       <div class="btn btn-primary btn-sm rounded" id="addTableRow">           <i class="fas fa-plus white-text mr-2"></i>Добавить строку       </div>   </div></div>'),$(".newTable table th").css({"text-align":"center","vertical-align":"middle","font-weight":"bold"}),$(".newTable table td").css("text-align","left"),$(".newTable table tbody tr:first td").css("text-align","center"),$(".newTable table tbody tr").each(function(){$("td:first",this).css("text-align","center")})}else $(C).append('<div class="row ml-1 mb-3 d-flex align-items-center justify-content-center" id="catalogTables" type="tableHtml" data-field="'+a.field.fieldId+' data-value="">   <div class="col-md-3 text-left mt-3">       <div class="text-muted">'+a.field.name+r+'</div>   </div>   <div class="col-md-9 text-left newTable">       <div class="btn btn-primary btn-sm rounded" id="tableTemplates" data-click="">Создать таблицу</div>   </div></div>')}}).done(function(e){var t="#blockFields, #blockUp, #blockDown, #btnSave, #btnWordFile";G&&1===G&&(t="#blockFieldsNew, #blockUpNew, #blockDownNew, #btnSaveNew, #btnWordFileNew"),0==e.length&&$(t).addClass("d-none")})}function getDownFields(e,F,N,D,E){var G="#blockGroup",C="blockGroup",S="#newBlockGroup",_=".blockName",A="delGroup",O="cloneGroup",R=1,L="nameGroup",U=".addGroup";return D&&1===D&&(G="#blockGroupNew",C="blockGroupNew",S="#newBlockGroupNew",_=".blockNameNew",A="delGroupNew",O="cloneGroupNew",R=2,L="nameGroupNew",U=".addGroupNew"),$.getJSON(e,function(e){var t=e;0<F&&1!==D&&(t=e.childFields),0<F&&(N=1);var l="",a="";for(var d in t){var i=t[d];if("GROUP_FIELDS"===i.field.fieldType){$("#blockDown").removeClass("d-none");var s=e[d=parseInt(d)];0<F&&(s=i);var c=1;""!=N&&(c=N);var n=" d-none";0<F?(l=' data-id="'+s.field.id+'"',a=s.field.id,1<N&&(n="")):""!=N&&(n="");var r="Блок "+c;for(var o in E&&(r="Блок "+E),$(S).append('<div class="row card mb-3 '+C+'" id="'+C+c+'" data-field="'+c+'"'+l+'><div class="col-12"><div class="card-body"><div class="row"><div class="col-md-9 text-left"><h5 class="'+L+'">'+r+'</h5></div><div class="col-md-3 text-right"><div id="'+O+c+'" class="btn btn-mdb-color btn-sm cloneGroup rounded d-none" title="Дублировать блок"><i class="fas fa-copy"></i></div><div id="'+A+c+'" data-toggle="modal" data-target="#deleteBlock" class="btn btn-danger btn-sm delGroup rounded'+n+' ml-3" title="Удалить блок"><i class="fas fa-trash"></i></div></div></div><hr><div class="row"><div class="col-12 blockGroupFields" data-block="'+R+'"></div></div></div></div></div>'),$(_).html(s.field.name).attr("data-block",s.field.fieldId),!1===i.field.enabled&&$(U+", ."+L).addClass("d-none"),!0===i.field.enabled&&$(U+", ."+L).removeClass("d-none"),s.field.childFields){var f=s.field.childFields[o],v="",p="";0<f.parentCatalogId&&(p=" p"+f.parentCatalogId,v=" d-none");var m="";0<F&&(0<f.parentCatalogId&&(p=" p"+f.parentCatalogId,v=f.valueInt&&0<f.valueInt?"":" d-none"),l=' data-id="'+f.id+'"',a=f.id,m=f.valueInt);var u="";0==f.enabled&&(u=" disabled");var b="",h="",I="";1==f.required&&(b=" required",h='<sup><i class="fas fa-star-of-life ml-1 text-danger"></i></sup>',I='<div class="invalid-feedback">Поле обязательно для заполнения</div>');var w="selectField_"+c+"_"+R+o;if("CATALOG"===f.fieldType){$(G+c+" .blockGroupFields").append('<div class="row blockRow'+v+p+'" data-row="'+o+'"><div class="col-md-3 text-left mt-3 d-flex align-items-center"><div class="text-muted">'+f.name+h+'</div></div><div class="col-md-9 mt-3"><select data-placeholder="Выберите вид документа" class="chosen-select" id="'+w+'" name="'+w+'" data-catalog="'+f.catalogId+'" data-field="'+f.fieldId+'"'+l+u+b+'><option value="">Выберите значение справочника</option></select>'+I+"</div></div>");var x="#"+w;$(x).chosen({width:"100%",no_results_text:"Ничего не найдено!"}),createOptionsValue(x,G+c,".blockRow"),""==v&&createOptions("rest/profile/catalogs/"+f.catalogId+"/elems",x,"valueStr","id",m,"")}if("CATALOG_ORGANIZATIONS"===f.fieldType){x="#"+w;$(G+c+" .blockGroupFields").append('<div class="row blockRow d-flex align-items-center'+v+p+'" data-row="'+o+'"><div class="col-md-3 text-left mt-3"><div class="text-muted">'+f.name+h+'</div></div><div class="col-md-8 mt-3"><select data-placeholder="Выберите вид документа" class="chosen-select" id="'+w+'" name="'+w+'" data-catalog="'+f.catalogId+'" data-field="'+f.fieldId+'"'+l+u+b+'><option value="">Выберите значение справочника</option></select></div><div class="col-md-1 mt-3 text-right"><button class="btn btn-primary btn-sm addElement rounded m-0 px-3 waves-effect" data-toggle="modal" data-target="#addElement" data-catalog="'+x+'" type="button" title="Добавить организацию" '+u+'><i class="fas fa-plus white-text"></i></button></div><div class="col-md-3"></div><div class="col-9">'+I+"</div></div>"),$(x).chosen({width:"100%",no_results_text:"Ничего не найдено!"}),createOptions("rest/profile/organizations/",x,"shortNameLf","id",m,"")}if("CATALOG_USERS"===f.fieldType){x="#"+w;$(G+c+" .blockGroupFields").append('<div class="row blockRow d-flex align-items-center'+v+p+'" data-row="'+o+'"><div class="col-md-3 text-left mt-3"><div class="text-muted">'+f.name+h+'</div></div><div class="col-md-9 mt-3"><select data-placeholder="Выберите вид документа" class="chosen-select" id="'+w+'" name="'+w+'" data-catalog="'+f.catalogId+'" data-field="'+f.fieldId+'"'+l+u+b+'><option value="">Выберите значение справочника</option></select>'+I+"</div></div>"),$(x).chosen({width:"100%",no_results_text:"Ничего не найдено!"}),createOptions("rest/profile/users/",x,"","id",m,"users")}if("ATTACHMENT"===f.fieldType&&""==v){var g=1;F&&0<F&&(g=2),$(G+c+" .blockGroupFields").append('<div class="row blockRow d-flex align-items-center'+v+p+'" data-row="'+o+'"><div class="col-md-3 text-left"><div class="text-muted">'+f.name+h+'</div></div><div class="col-md-9"></div></div>'),createInput(".col-md-9:last","file","inputFile","inputFile","Загрузить файл",0,""+f.name,f.valueStr,f.fieldId,0,a,f.enabled,f.required,g,"")}if("TEXTAREA"===f.fieldType&&""==v&&$(G+c+" .blockGroupFields").append('<div class="row blockRow'+v+p+'" data-row="'+o+'"><div class="col-md-3 text-left mt-3"><div class="text-muted">'+f.name+h+'</div></div><div class="col-md-9 mt-3"><textarea></textarea>'+I+"</div></div>"),"TEXT"===f.fieldType&&""==v){var T="",k=o+1;0<F&&(T=f.id+"_");var y="inputText_"+c+"_"+T+k;$(G+c+" .blockGroupFields").append('<div class="row blockRow d-flex align-items-center'+v+p+'" data-row="'+o+'"><div class="col-md-3 text-left mt-3"><div class="text-muted">'+f.name+h+'</div></div><div class="col-md-9 mt-3"></div></div>'),createInput(".col-md-9:last","text",y,y,"Введите значение",0,""+f.name,f.valueStr,f.fieldId,0,a,f.enabled,f.required,"",1),k+=1}}0<F&&(N+=1)}else $("#blockDown").addClass("d-none")}}).done(function(e){var t="#blockFields, #blockUp, #blockDown, #btnSave, #btnWordFile";D&&1===D&&(t="#blockFieldsNew, #blockUpNew, #blockDownNew, #btnSaveNew, #btnWordFileNew"),0==e.length&&$(t).addClass("d-none")})}function createDataField(p,e){var t=".upElem";e&&1===e&&(t=".upElemNew");p=parseInt(p);var m=[],u="",b=null,h="";return $(t).each(function(e){var t=e+1,l=$(this).attr("type"),a=$(this).val(),d=parseInt($(this).attr("data-field")),i=$(".chosen-select",this).attr("type"),s=parseInt($(".chosen-select",this).attr("data-field")),c=parseInt($(".chosen-select",this).val()),n=null,r=null,o=null;if("date"===l&&(h=1,""!=a&&(n=a+"T00:00:00",0)),"time"===l&&(h=1,""!=a&&(n="1900-01-01T"+a+":00")),"text"===l&&(h=2,""!=a&&(n=a)),"select"===i&&(h=3,0<c&&(n=c)),"checkbox"===l&&(h=4,0<a&&(n=a)),"tableHtml"===l&&(h=5,r=$("#catalogTables").attr("data-value"),$(".editTable .deleteElem, .editTable h6").remove(),o=$(".editTable").html()),0<p&&(b=parseInt($(this).attr("data-id"))),1===h)u={field:{id:b,childFields:[],fieldId:d,valueDate:n},position:t};else if(2===h)u={field:{id:b,childFields:[],fieldId:d,valueStr:n},position:t};else if(3===h)0<p&&(b=parseInt($(".chosen-select",this).attr("data-id"))),u={field:{id:b,childFields:[],fieldId:s,valueInt:n},position:t};else if(4===h){0<p&&(b=parseInt($(this).attr("data-id")));var f=[],v="";$(".childBox .checkClass").each(function(){var e=null,t=$(this).val(),l=parseInt($(this).attr("data-field"));0<p&&(e=parseInt($(this).attr("data-id"))),v={id:e,childFields:[],fieldId:l,valueStr:t},f.push(v)}),u={field:{id:b,childFields:f,fieldId:d,valueInt:n},position:t}}else 5===h&&(u={field:{id:b,childFields:[],fieldId:d,valueInt:r,valueStr:o},position:t});m.push(u)}),m}function createDataBlock(c,n,e){var t=".blockGroup";e&&1===e&&(t=".blockGroupNew");c=parseInt(c);var r=null,o=[];return $(".BlockDiv").each(function(){var e=$(this).attr("id");$("#"+e+" .blockField "+t).each(function(e){var t=parseInt(e)+1;if($(this).attr("data-field")==t){var l=$(this).attr("id"),i=[];$("#"+l+" [data-field]").each(function(){var e=$(this).attr("type");if(0<c&&(r=parseInt($(this).attr("data-id"))),e&&""!=e){if("tableHtml"===e){var t=$(this).attr("data-value"),l="#"+$(this).attr("id");$(l+" .editTable .deleteElem, "+l+" .tableHtml .editTable h6").remove();var a=$(l+" .editTable").html(),d={id:r,childFields:[],fieldId:parseInt($(this).attr("data-field")),valueInt:t,valueStr:a}}else if("select"===e)d={id:r,childFields:[],fieldId:parseInt($(this).attr("data-field")),valueInt:parseInt($(this).val())};else if("text"===e)d={id:r,childFields:[],fieldId:parseInt($(this).attr("data-field")),valueStr:$(this).val()}}else d={id:r,childFields:[],fieldId:parseInt($(this).attr("data-field")),valueStr:$(this).val()};i.push(d)});var a=parseInt(n)+t,d=parseInt($("#"+l).attr("data-div"));0<c&&(r=parseInt($("#"+l).attr("data-id")));var s={field:{id:r,childFields:i,fieldId:d},position:a}}else alert($(this).attr("data-field")+" - "+t);o.push(s)})}),o}function createAgreeList(e){var t=[],l=$(e).length,a=!1,d=!1;for(var i in e)if(i<l){var s=parseInt(i)+1;a=s===l,d=1===s;var c={id:null,ordering:s,user:{id:e[i].value},finalUser:a,currentUser:d};t.push(c)}return t}function createJSON(e,t,l,a,d){0===(e=parseInt(e))&&(e=null);var i=[],s=[],c="#whomList",n="#userListBlock";d&&1===d&&(c="#whomListNew",n="#userListBlockNew");for(var r=$(n+" select:last").val(),o=(c=ChosenOrder.getSelectionOrder($(c).get(0)),0);o<c.length;o++){var f=c[o];""!==f&&s.push(f)}if(d&&2===d&&(r=$("#userListBlockDiv .row:last").attr("data-value"),$("#whomList div").each(function(){var e=$(this).attr("data-value");""!==e&&s.push(e)})),""!==l)for(var v in l)i.push(l[v]);if(""!==a)for(var v in a)i.push(a[v]);if(d&&2===d)var p=$("#commentText textarea").val(),m={id:e,docTypeId:parseInt(t),executorDepartmentsIds:s,finalUserId:r,comment:p,childFields:i};else if(d&&1===d)m={id:null,docTypeId:parseInt(t),executorDepartmentsIds:s,finalUserId:r,parentDocId:e,childFields:i};else m={id:e,docTypeId:parseInt(t),executorDepartmentsIds:s,finalUserId:r,childFields:i};return m}function getDepartments(e){$.ajax({url:e,dataType:"json",async:!1,success:function(e){$("#whomList").append('<div class="d-inline-block chip light-blue lighten-2 white-text my-1 mr-2" data-value="'+e.id+'">'+e.name+"</div>")}})}function createWhomListDisabled(e){for(var t in e){getDepartments("rest/profile/departments/"+e[t])}}function createUserListDisabled(e,n){return $.getJSON(e,function(e){for(var t in e){var l=e[t],a="",d="",i="",s="";if(l.agreedDateTime)i=formatDate(l.agreedDateTime)+"/"+formatTime(l.agreedDateTime);l.comment&&(d=l.comment),l.position&&(a=l.position);var c="";!0===l.currentUser?(c='<i class="fas fa-user-clock text-warning" title="Текущий согласователь"></i>',1!==n&&(s='<button class="btn btn-primary btn-sm px-2 py-1 mx-3 btnReturn" type="button" data-undo="'+l.userId+'" title="Перенаправить на согласование"><i class="fas fa-undo-alt text-white"></i></button>')):c='<i class="fas fa-ellipsis-h text-muted" title="Согласователь"></i>',l.decisionType&&"ACCEPTED"===l.decisionType&&(c='<i class="fas fa-check text-success" title="Согласование завершено"></i>',!0===l.finalUser&&(c='<i class="fas fa-check-circle text-success" title="Финальный согласователь"></i>')),l.decisionType&&"REDIRECTED"===l.decisionType&&(c='<i class="fas fa-undo-alt text-primary" title="Перенаправление"></i>'),l.decisionType&&"REJECTED"===l.decisionType&&(c='<i class="fas fa-times text-danger" title="Согалсование отменено"></i>'),$("#userListBlockDiv").append('<div class="row mb-3 d-flex align-items-center" data-value="'+l.userId+'"><div class="col-1 text-center">'+l.ordering+'</div><div class="col-1 text-center">'+c+'</div><div class="col-4">'+l.fullName+s+'<br><small class="text-muted">'+a+'</small></div><div class="col-3"><small>'+d+'</small></div><div class="col-3"><small>'+i+"</small></div></div>")}})}