function createDataField(f,e){var t=".upElem";e&&1===e&&(t=".upElemNew");f=parseInt(f);var p=[],v="",m=null,I="";return $(t).each(function(e){var t=e+1,i=$(this).attr("type"),a=$(this).val(),l=parseInt($(this).attr("data-field")),s=$(".chosen-select",this).attr("type"),d=parseInt($(".chosen-select",this).attr("data-field")),r=parseInt($(".chosen-select",this).val()),n=null,c=null,o=null;if("date"===i&&(I=1,""!=a&&(n=a+"T00:00:00",0)),"time"===i&&(I=1,""!=a&&(n="1900-01-01T"+a+":00")),"text"===i&&(I=2,""!=a&&(n=a)),"select"===s&&(I=3,0<r&&(n=r)),"checkbox"===i&&(I=4,0<a&&(n=a)),"tableHtml"===i&&(I=5,c=$("#catalogTables").attr("data-value"),$(".editTable .deleteElem").remove(),$(".editTable h6").remove(),o=$(".editTable").html()),0<f&&(m=parseInt($(this).attr("data-id"))),1===I)v={field:{id:m,childFields:[],fieldId:l,valueDate:n},position:t};else if(2===I)v={field:{id:m,childFields:[],fieldId:l,valueStr:n},position:t};else if(3===I)0<f&&(m=parseInt($(".chosen-select",this).attr("data-id"))),v={field:{id:m,childFields:[],fieldId:d,valueInt:n},position:t};else if(4===I){0<f&&(m=parseInt($(this).attr("data-id")));var u=[],h="";$(".childBox .checkClass").each(function(){var e=null;0<f&&(e=parseInt($(this).attr("data-id")));var t=$(this).val(),i=parseInt($(this).attr("data-field")),a=$(this).attr("type");h="select"===a?{id:e,childFields:[],fieldId:i,valueInt:t}:{id:e,childFields:[],fieldId:i,valueStr:t},u.push(h)}),v={field:{id:m,childFields:u,fieldId:l,valueInt:n},position:t}}else 5===I&&(v={field:{id:m,childFields:[],fieldId:l,valueInt:c,valueStr:o},position:t});p.push(v)}),p}function createDataBlock(d,a,e){var t=".blockGroup",l=".blockElement";e&&1===e&&(t=".blockGroupNew",l=".blockElementNew");d=parseInt(d);var r=null,n=[];return $(".BlockDiv").each(function(){$(t,this).each(function(){var e=parseInt($(this).attr("data-div"));0<d&&(r=parseInt($(this).attr("data-id")));var s=[];$(l,this).each(function(){var e=$(this).attr("type");if(0<d&&(r=parseInt($(this).attr("data-id"))),e&&""!=e){if("tableHtml"===e){var t=$(this).attr("data-value"),i="#"+$(this).attr("id");$(i+" .editTable .deleteElem, "+i+" .editTable h6").remove();var a=$(i+" .editTable").html(),l={id:r,childFields:[],fieldId:parseInt($(this).attr("data-field")),valueInt:t,valueStr:a}}else if("select"===e)l={id:r,childFields:[],fieldId:parseInt($(this).attr("data-field")),valueInt:parseInt($(this).val())};else if("text"===e)l={id:r,childFields:[],fieldId:parseInt($(this).attr("data-field")),valueStr:$(this).val()}}else l={id:r,childFields:[],fieldId:parseInt($(this).attr("data-field")),valueStr:$(this).val()};s.push(l)});var t=parseInt(a)+parseInt(countElem(n)),i={field:{id:r,childFields:s,fieldId:e},position:t};n.push(i)})}),n}function createAgreeList(e){var t=[],i=$(e).length,a=!1,l=!1;for(var s in e)if(s<i){var d=parseInt(s)+1;a=d===i,l=1===d;var r={id:null,ordering:d,user:{id:e[s].value},finalUser:a,currentUser:l};t.push(r)}return t}function createJSON(e,t,i,a,l){0===(e=parseInt(e))&&(e=null);var s=[],d=[],r="#whomList",n="#userListBlock";l&&1===l&&(r="#whomListNew",n="#userListBlockNew");for(var c=$(n+" select:last").val(),o=(r=ChosenOrder.getSelectionOrder($(r).get(0)),0);o<r.length;o++){var u=r[o];""!==u&&d.push(u)}if(l&&2===l&&(c=$("#userListBlockDiv .row:last").attr("data-value"),$("#whomList div").each(function(){var e=$(this).attr("data-value");""!==e&&d.push(e)})),""!==i)for(var h in i)s.push(i[h]);if(""!==a)for(var h in a)s.push(a[h]);if(l&&2===l)var f=$("#commentText textarea").val(),p={id:e,docTypeId:parseInt(t),executorDepartmentsIds:d,finalUserId:c,comment:f,childFields:s};else if(l&&1===l)p={id:null,docTypeId:parseInt(t),executorDepartmentsIds:d,finalUserId:c,parentDocId:e,childFields:s};else p={id:e,docTypeId:parseInt(t),executorDepartmentsIds:d,finalUserId:c,childFields:s};return p}function getDepartments(e){$.ajax({url:e,dataType:"json",async:!1,success:function(e){$("#whomList").append('<div class="d-inline-block chip light-blue lighten-2 white-text my-1 mr-2" data-value="'+e.id+'">'+e.name+"</div>")}})}function createWhomListDisabled(e){for(var t in e){getDepartments("rest/profile/departments/"+e[t])}}function createUserListDisabled(e,n){return $.getJSON(e,function(e){for(var t in e){var i=e[t],a="",l="",s="",d="";if(i.agreedDateTime)s=formatDate(i.agreedDateTime)+"/"+formatTime(i.agreedDateTime);i.comment&&(l=i.comment),i.position&&(a=i.position);var r="";!0===i.currentUser?(r='<i class="fas fa-user-clock text-warning" title="Текущий согласователь"></i>',1!==n&&(d='<button class="btn btn-primary btn-sm px-2 py-1 mx-3 btnReturn" type="button" data-undo="'+i.userId+'" title="Перенаправить на согласование"><i class="fas fa-undo-alt text-white"></i></button>')):r='<i class="fas fa-ellipsis-h text-muted" title="Согласователь"></i>',i.decisionType&&"ACCEPTED"===i.decisionType&&(r='<i class="fas fa-check text-success" title="Согласование завершено"></i>',!0===i.finalUser&&(r='<i class="fas fa-check-circle text-success" title="Финальный согласователь"></i>')),i.decisionType&&"REDIRECTED"===i.decisionType&&(r='<i class="fas fa-undo-alt text-primary" title="Перенаправление"></i>'),i.decisionType&&"REJECTED"===i.decisionType&&(r='<i class="fas fa-times text-danger" title="Согалсование отменено"></i>'),$("#userListBlockDiv").append('<div class="row mb-3 d-flex align-items-center" data-value="'+i.userId+'"><div class="col-1 text-center">'+i.ordering+'</div><div class="col-1 text-center">'+r+'</div><div class="col-4">'+i.fullName+d+'<br><small class="text-muted">'+a+'</small></div><div class="col-3"><small>'+l+'</small></div><div class="col-3"><small>'+s+"</small></div></div>")}})}